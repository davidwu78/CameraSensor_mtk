CXX = g++
PKG_CONFIG_CFLAGS = $(shell pkg-config --cflags gstreamer-1.0 gstreamer-video-1.0 gstreamer-app-1.0 glib-2.0 tcam opencv4)
PKG_CONFIG_LIBS = $(shell pkg-config --libs gstreamer-1.0 gstreamer-video-1.0 gstreamer-app-1.0 glib-2.0 tcam opencv4)
CXXFLAGS = -O3 -Wall -shared -std=c++20 -fPIC $(PKG_CONFIG_CFLAGS) $(shell python3 -m pybind11 --includes) -DBUILD_WIDGET
CXXFLAGS += -DCUDASCALE_EXISTS=$(shell gst-inspect-1.0 cudascale > /dev/null 2>&1 && echo 1 || echo 0)
CXXFLAGS += -I /usr/include/eigen3
LDFLAGS = $(PKG_CONFIG_LIBS)
EXT_SUFFIX = $(shell python3-config --extension-suffix)
TARGET = recorder_module$(EXT_SUFFIX)
SOURCES = recorder.cpp tcamcamera.cpp common.cpp modules/record.cpp modules/snapshot.cpp modules/display.cpp modules/udp.cpp modules/loop_record.cpp modules/monitor.cpp kalmanfilter.cpp

$(TARGET): $(SOURCES)
	$(CXX) $(CXXFLAGS) $(SOURCES) -o $(TARGET) $(LDFLAGS)
	stubgen -m recorder_module -o ./ --include-docstring

clean:
	rm -f $(TARGET)
